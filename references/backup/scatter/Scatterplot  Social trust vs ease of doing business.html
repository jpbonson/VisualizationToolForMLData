<!DOCTYPE html>
<!-- saved from url=(0034)http://bl.ocks.org/nsonnad/4481531 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<title>Scatterplot: Social trust vs ease of doing business</title>
<link rel="icon" href="http://bl.ocks.org/favicon.png">
<style>

@import url("/style.css?20120730");

header,
footer {
  color: #555;
}

a.gist {
  color: #000;
}

</style>

<style type="text/css"></style></head><body><header>
  <a href="http://bl.ocks.org/nsonnad">nsonnad</a>â€™s block
  <a class="gist" title="View gist #4481531 on GitHub" href="https://gist.github.com/nsonnad/4481531">#4481531</a>
  <span class="date">January 8, 2013</span>
</header>

<h1>Scatterplot: Social trust vs ease of doing business</h1>


<iframe src="./Scatterplot  Social trust vs ease of doing business_files/saved_resource.html" marginwidth="0" marginheight="0" scrolling="no"></iframe>
<p></p><aside><a style="position:relative;top:6px;" href="http://bl.ocks.org/nsonnad/raw/4481531/" target="_blank">Open in a new window.</a></aside>


<div class="gist-readme"><p>A scatterplot using d3js. It maps social trust against ease of doing business in various countries. For tooltips, it makes use of Justin Donaldson's fork of the jQuery plugin tipsy. Data come from the Pew Global Attitudes project and the Doing Business rankings. For a live example see <a href="http://theoldbeggar.com/posts/chart-trust-business/">my post on it</a> or http://bl.ocks.org/4481531</p></div>

<div class="gist-sources"><div class="gist-source"><h2>index.html<a name="index.html" href="http://bl.ocks.org/nsonnad/4481531#index.html">#</a></h2><pre><code class="html xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
  <span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Trust and Business<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://d3js.org/d3.v3.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.jquery.com/jquery-1.8.3.min.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
	<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"jquery.tipsy.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
	<span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"http://onehackoranother.com/projects/jquery/tipsy/stylesheets/tipsy.css"</span> <span class="attribute">type</span>=<span class="value">"text/css"</span> <span class="attribute">title</span>=<span class="value">"no title"</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>/&gt;</span>
<span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">"text/css"</span>&gt;</span><span class="css">
	<span class="class">.axis</span> <span class="tag">path</span>,
	<span class="class">.axis</span> <span class="tag">line</span> <span class="rules">{
	  <span class="rule"><span class="attribute">fill</span>:<span class="value"> none</span>;</span>
	  <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="number">#000</span></span>;</span>
	  <span class="rule"><span class="attribute">shape-rendering</span>:<span class="value"> crispEdges</span>;</span>
	  <span class="rule"><span class="attribute">opacity</span>:<span class="value"> <span class="number">1</span></span>;</span>
	<span class="rule">}</span></span>

	<span class="class">.axis</span> <span class="tag">text</span> <span class="rules">{ <span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">10</span>px</span>;</span> <span class="rule">}</span></span>

	<span class="tag">body</span> <span class="rules">{ <span class="rule"><span class="attribute">font</span>:<span class="value"> <span class="number">12</span>px sans-serif</span>;</span> <span class="rule">}</span></span>
	<span class="class">.circles</span> <span class="rules">{ <span class="rule"><span class="attribute">opacity</span>:<span class="value"> .<span class="number">5</span></span>;</span> <span class="rule">}</span></span>

	<span class="class">.tipsy</span> <span class="rules">{ <span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">11</span>px</span>;</span> <span class="rule"><span class="attribute">margin-top</span>:<span class="value">-<span class="number">10</span>px</span>;</span><span class="rule">}</span></span>

	<span class="class">.guide</span> <span class="tag">line</span> <span class="rules">{
	  <span class="rule"><span class="attribute">fill</span>:<span class="value"> none</span>;</span>
	  <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="number">#000</span></span>;</span>
	  <span class="rule"><span class="attribute">shape-rendering</span>:<span class="value"> crispEdges</span>;</span>
	  <span class="rule"><span class="attribute">opacity</span>:<span class="value"> <span class="number">0</span></span>;</span>
	<span class="rule">}</span></span>
</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"chart"</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
	<span class="comment">// set the stage</span>
	<span class="keyword">var</span> margin = {t:<span class="number">30</span>, r:<span class="number">20</span>, b:<span class="number">20</span>, l:<span class="number">40</span> },
		w = <span class="number">600</span> - margin.l - margin.r,
		h = <span class="number">500</span> - margin.t - margin.b,
		x = d3.scale.linear().range([<span class="number">0</span>, w]),
		y = d3.scale.linear().range([h - <span class="number">60</span>, <span class="number">0</span>]),
		<span class="comment">//colors that will reflect geographical regions</span>
		color = d3.scale.category10();

	<span class="keyword">var</span> svg = d3.select(<span class="string">"#chart"</span>).append(<span class="string">"svg"</span>)
		.attr(<span class="string">"width"</span>, w + margin.l + margin.r)
		.attr(<span class="string">"height"</span>, h + margin.t + margin.b);

	<span class="comment">// set axes, as well as details on their ticks</span>
	<span class="keyword">var</span> xAxis = d3.svg.axis()
		.scale(x)
		.ticks(<span class="number">20</span>)
		.tickSubdivide(<span class="literal">true</span>)
		.tickSize(<span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>)
		.orient(<span class="string">"bottom"</span>);

	<span class="keyword">var</span> yAxis = d3.svg.axis()
		.scale(y)
		.ticks(<span class="number">20</span>)
		.tickSubdivide(<span class="literal">true</span>)
		.tickSize(<span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>)
		.orient(<span class="string">"left"</span>);

	<span class="comment">// group that will contain all of the plots</span>
	<span class="keyword">var</span> groups = svg.append(<span class="string">"g"</span>).attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.l + <span class="string">","</span> + margin.t + <span class="string">")"</span>);

	<span class="comment">// array of the regions, used for the legend</span>
	<span class="keyword">var</span> regions = [<span class="string">"Asia"</span>, <span class="string">"Europe"</span>, <span class="string">"Middle East"</span>, <span class="string">"N. America"</span>, <span class="string">"S. America"</span>, <span class="string">"Sub-Saharan Africa"</span>]


<span class="comment">// bring in the data, and do everything that is data-driven</span>
d3.csv(<span class="string">"trust-business.csv"</span>, <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>

	<span class="comment">// sort data alphabetically by region, so that the colors match with legend</span>
	data.sort(<span class="function"><span class="keyword">function</span><span class="params">(a, b)</span> {</span> <span class="keyword">return</span> d3.ascending(a.region, b.region); })
	console.log(data)

	<span class="keyword">var</span> x0 = Math.max(-d3.min(data, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.trust; }), d3.max(data, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.trust; }));
	x.domain([-<span class="number">100</span>, <span class="number">100</span>]);
	y.domain([<span class="number">180</span>, <span class="number">0</span>])

	<span class="comment">// style the circles, set their locations based on data</span>
	<span class="keyword">var</span> circles =
	groups.selectAll(<span class="string">"circle"</span>)
		.data(data)
	  .enter().append(<span class="string">"circle"</span>)
	  .attr(<span class="string">"class"</span>, <span class="string">"circles"</span>)
	  .attr({
	    cx: <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> x(+d.trust); },
	    cy: <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> y(+d.business); },
	    r: <span class="number">8</span>,
	    id: <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.country; }
	  })
		.style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> color(d.region); });

	<span class="comment">// what to do when we mouse over a bubble</span>
	<span class="keyword">var</span> mouseOn = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> 
		<span class="keyword">var</span> circle = d3.select(<span class="keyword">this</span>);

	<span class="comment">// transition to increase size/opacity of bubble</span>
		circle.transition()
		.duration(<span class="number">800</span>).style(<span class="string">"opacity"</span>, <span class="number">1</span>)
		.attr(<span class="string">"r"</span>, <span class="number">16</span>).ease(<span class="string">"elastic"</span>);

		<span class="comment">// append lines to bubbles that will be used to show the precise data points.</span>
		<span class="comment">// translate their location based on margins</span>
		svg.append(<span class="string">"g"</span>)
			.attr(<span class="string">"class"</span>, <span class="string">"guide"</span>)
		.append(<span class="string">"line"</span>)
			.attr(<span class="string">"x1"</span>, circle.attr(<span class="string">"cx"</span>))
			.attr(<span class="string">"x2"</span>, circle.attr(<span class="string">"cx"</span>))
			.attr(<span class="string">"y1"</span>, +circle.attr(<span class="string">"cy"</span>) + <span class="number">26</span>)
			.attr(<span class="string">"y2"</span>, h - margin.t - margin.b)
			.attr(<span class="string">"transform"</span>, <span class="string">"translate(40,20)"</span>)
			.style(<span class="string">"stroke"</span>, circle.style(<span class="string">"fill"</span>))
			.transition().delay(<span class="number">200</span>).duration(<span class="number">400</span>).styleTween(<span class="string">"opacity"</span>, 
						<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> d3.interpolate(<span class="number">0</span>, .<span class="number">5</span>); })

		svg.append(<span class="string">"g"</span>)
			.attr(<span class="string">"class"</span>, <span class="string">"guide"</span>)
		.append(<span class="string">"line"</span>)
			.attr(<span class="string">"x1"</span>, +circle.attr(<span class="string">"cx"</span>) - <span class="number">16</span>)
			.attr(<span class="string">"x2"</span>, <span class="number">0</span>)
			.attr(<span class="string">"y1"</span>, circle.attr(<span class="string">"cy"</span>))
			.attr(<span class="string">"y2"</span>, circle.attr(<span class="string">"cy"</span>))
			.attr(<span class="string">"transform"</span>, <span class="string">"translate(40,30)"</span>)
			.style(<span class="string">"stroke"</span>, circle.style(<span class="string">"fill"</span>))
			.transition().delay(<span class="number">200</span>).duration(<span class="number">400</span>).styleTween(<span class="string">"opacity"</span>, 
						<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> d3.interpolate(<span class="number">0</span>, .<span class="number">5</span>); });

	<span class="comment">// function to move mouseover item to front of SVG stage, in case</span>
	<span class="comment">// another bubble overlaps it</span>
		d3.selection.prototype.moveToFront = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> 
		  <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> 
			<span class="keyword">this</span>.parentNode.appendChild(<span class="keyword">this</span>); 
		  }); 
		};

	<span class="comment">// skip this functionality for IE9, which doesn't like it</span>
		<span class="keyword">if</span> (!$.browser.msie) {
			circle.moveToFront();	
			}
	};
	<span class="comment">// what happens when we leave a bubble?</span>
	<span class="keyword">var</span> mouseOff = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
		<span class="keyword">var</span> circle = d3.select(<span class="keyword">this</span>);

		<span class="comment">// go back to original size and opacity</span>
		circle.transition()
		.duration(<span class="number">800</span>).style(<span class="string">"opacity"</span>, .<span class="number">5</span>)
		.attr(<span class="string">"r"</span>, <span class="number">8</span>).ease(<span class="string">"elastic"</span>);

		<span class="comment">// fade out guide lines, then remove them</span>
		d3.selectAll(<span class="string">".guide"</span>).transition().duration(<span class="number">100</span>).styleTween(<span class="string">"opacity"</span>, 
						<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> d3.interpolate(.<span class="number">5</span>, <span class="number">0</span>); })
			.remove()
	};

	<span class="comment">// run the mouseon/out functions</span>
	circles.on(<span class="string">"mouseover"</span>, mouseOn);
	circles.on(<span class="string">"mouseout"</span>, mouseOff);

	<span class="comment">// tooltips (using jQuery plugin tipsy)</span>
	circles.append(<span class="string">"title"</span>)
			.text(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d.country; })

	$(<span class="string">".circles"</span>).tipsy({ gravity: <span class="string">'s'</span>, });

	<span class="comment">// the legend color guide</span>
	<span class="keyword">var</span> legend = svg.selectAll(<span class="string">"rect"</span>)
			.data(regions)
		.enter().append(<span class="string">"rect"</span>)
		.attr({
		  x: <span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span> <span class="keyword">return</span> (<span class="number">40</span> + i*<span class="number">80</span>); },
		  y: h,
		  width: <span class="number">25</span>,
		  height: <span class="number">12</span>
		})
		.style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> color(d); });


	<span class="comment">// legend labels	</span>
		svg.selectAll(<span class="string">"text"</span>)
			.data(regions)
		.enter().append(<span class="string">"text"</span>)
		.attr({
		x: <span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span> <span class="keyword">return</span> (<span class="number">40</span> + i*<span class="number">80</span>); },
		y: h + <span class="number">24</span>,
		})
		.text(<span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d; });

	<span class="comment">// draw axes and axis labels</span>
	svg.append(<span class="string">"g"</span>)
		.attr(<span class="string">"class"</span>, <span class="string">"x axis"</span>)
		.attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.l + <span class="string">","</span> + (h - <span class="number">60</span> + margin.t) + <span class="string">")"</span>)
		.call(xAxis);

	svg.append(<span class="string">"g"</span>)
		.attr(<span class="string">"class"</span>, <span class="string">"y axis"</span>)
		.attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + margin.l + <span class="string">","</span> + margin.t + <span class="string">")"</span>)
		.call(yAxis);

	svg.append(<span class="string">"text"</span>)
		.attr(<span class="string">"class"</span>, <span class="string">"x label"</span>)
		.attr(<span class="string">"text-anchor"</span>, <span class="string">"end"</span>)
		.attr(<span class="string">"x"</span>, w + <span class="number">50</span>)
		.attr(<span class="string">"y"</span>, h - margin.t - <span class="number">5</span>)
		.text(<span class="string">"others in society seen as trustworthy*"</span>);

	svg.append(<span class="string">"text"</span>)
		.attr(<span class="string">"class"</span>, <span class="string">"y label"</span>)
		.attr(<span class="string">"text-anchor"</span>, <span class="string">"end"</span>)
		.attr(<span class="string">"x"</span>, -<span class="number">20</span>)
		.attr(<span class="string">"y"</span>, <span class="number">45</span>)
		.attr(<span class="string">"dy"</span>, <span class="string">".75em"</span>)
		.attr(<span class="string">"transform"</span>, <span class="string">"rotate(-90)"</span>)
		.text(<span class="string">"ease of doing business (rank)"</span>);
	});

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre></div><div class="gist-source"><h2>jquery.tipsy.js<a name="jquery.tipsy.js" href="http://bl.ocks.org/nsonnad/4481531#jquery.tipsy.js">#</a></h2><pre><code class="javascript"><span class="comment">// tipsy, facebook style tooltips for jquery</span>
<span class="comment">// version 1.0.0a</span>
<span class="comment">// (c) 2008-2010 jason frame [jason@onehackoranother.com]</span>
<span class="comment">// released under the MIT license</span>

(<span class="function"><span class="keyword">function</span><span class="params">($)</span> {</span>
    
    <span class="function"><span class="keyword">function</span> <span class="title">maybeCall</span><span class="params">(thing, ctx)</span> {</span>
        <span class="keyword">return</span> (<span class="keyword">typeof</span> thing == <span class="string">'function'</span>) ? (thing.call(ctx)) : thing;
    }

    <span class="comment">// CAUTION the current implementation does not allow for tipsied elements to stay out of DOM (in between events)</span>
    <span class="comment">// i.e. don't remove, store, then re-insert tipsied elements (and why would you want to do that anyway?)</span>
    <span class="keyword">var</span> garbageCollect = (<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        <span class="keyword">var</span> currentInterval;
        <span class="keyword">var</span> to = <span class="literal">null</span>;
        <span class="keyword">var</span> tipsies = [];

        <span class="function"><span class="keyword">function</span> <span class="title">_do</span><span class="params">()</span> {</span>
            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tipsies.length;) {
                <span class="keyword">var</span> t = tipsies[i];
                <span class="comment">// FIXME? the 2nd (non-paranoid) check is from the link below, it should be replaced if a better way is found</span>
                <span class="comment">// http://stackoverflow.com/questions/4040715/check-if-cached-jquery-object-is-still-in-dom</span>
                <span class="keyword">if</span> (t.options.gcInterval === <span class="number">0</span> || t.$element.closest(<span class="string">'body'</span>).length === <span class="number">0</span>) {
                    t.hoverState = <span class="string">'out'</span>;
                    t.hide();
                    tipsies.splice(i,<span class="number">1</span>);
                } <span class="keyword">else</span> {
                    i++;
                }
            }
        }
        <span class="function"><span class="keyword">function</span> <span class="title">_loop</span><span class="params">()</span> {</span>
            to = setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> _<span class="keyword">do</span>(); _loop(); }, currentInterval);
        }

        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(t)</span> {</span>
            <span class="keyword">if</span> (t.options.gcInterval === <span class="number">0</span>) <span class="keyword">return</span>;

            <span class="keyword">if</span> (to &amp;&amp; t.options.gcInterval &lt; currentInterval) {
                clearTimeout(to); to = <span class="literal">null</span>;
                currentInterval = t.options.gcInterval;
            }
            tipsies.push(t);
            <span class="keyword">if</span> (!to) _loop();
        };
    })();

    <span class="function"><span class="keyword">function</span> <span class="title">Tipsy</span><span class="params">(element, options)</span> {</span>
        <span class="keyword">this</span>.$element = $(element);
        <span class="keyword">this</span>.options = options;
        <span class="keyword">this</span>.enabled = <span class="literal">true</span>;
        <span class="keyword">this</span>.fixTitle();
        garbageCollect(<span class="keyword">this</span>);
    }

    
    Tipsy.prototype = {
        show: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">var</span> title = <span class="keyword">this</span>.getTitle();
            <span class="keyword">if</span> (title &amp;&amp; <span class="keyword">this</span>.enabled) {
                <span class="keyword">var</span> $tip = <span class="keyword">this</span>.tip();
                
                $tip.find(<span class="string">'.tipsy-inner'</span>)[<span class="keyword">this</span>.options.html ? <span class="string">'html'</span> : <span class="string">'text'</span>](title);
                $tip[<span class="number">0</span>].className = <span class="string">'tipsy'</span>; <span class="comment">// reset classname in case of dynamic gravity</span>
                $tip.remove().css({top: <span class="number">0</span>, left: <span class="number">0</span>, visibility: <span class="string">'hidden'</span>, display: <span class="string">'block'</span>}).prependTo(document.body);
                
                <span class="keyword">var</span> pos = $.extend({}, <span class="keyword">this</span>.$element.offset(), {
                    width: <span class="keyword">this</span>.$element[<span class="number">0</span>].offsetWidth || <span class="number">0</span>,
                    height: <span class="keyword">this</span>.$element[<span class="number">0</span>].offsetHeight || <span class="number">0</span>
                });

                <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.$element[<span class="number">0</span>].nearestViewportElement == <span class="string">'object'</span>) {
                    <span class="comment">// SVG</span>
  				<span class="keyword">var</span> el = <span class="keyword">this</span>.$element[<span class="number">0</span>];
                    <span class="keyword">var</span> rect = el.getBoundingClientRect();
					pos.width = rect.width;
					pos.height = rect.height;
                }

                
                <span class="keyword">var</span> actualWidth = $tip[<span class="number">0</span>].offsetWidth,
                    actualHeight = $tip[<span class="number">0</span>].offsetHeight,
                    gravity = maybeCall(<span class="keyword">this</span>.options.gravity, <span class="keyword">this</span>.$element[<span class="number">0</span>]);
                
                <span class="keyword">var</span> tp;
                <span class="keyword">switch</span> (gravity.charAt(<span class="number">0</span>)) {
                    <span class="keyword">case</span> <span class="string">'n'</span>:
                        tp = {top: pos.top + pos.height + <span class="keyword">this</span>.options.offset, left: pos.left + pos.width / <span class="number">2</span> - actualWidth / <span class="number">2</span>};
                        <span class="keyword">break</span>;
                    <span class="keyword">case</span> <span class="string">'s'</span>:
                        tp = {top: pos.top - actualHeight - <span class="keyword">this</span>.options.offset, left: pos.left + pos.width / <span class="number">2</span> - actualWidth / <span class="number">2</span>};
                        <span class="keyword">break</span>;
                    <span class="keyword">case</span> <span class="string">'e'</span>:
                        tp = {top: pos.top + pos.height / <span class="number">2</span> - actualHeight / <span class="number">2</span>, left: pos.left - actualWidth - <span class="keyword">this</span>.options.offset};
                        <span class="keyword">break</span>;
                    <span class="keyword">case</span> <span class="string">'w'</span>:
                        tp = {top: pos.top + pos.height / <span class="number">2</span> - actualHeight / <span class="number">2</span>, left: pos.left + pos.width + <span class="keyword">this</span>.options.offset};
                        <span class="keyword">break</span>;
                }
                
                <span class="keyword">if</span> (gravity.length == <span class="number">2</span>) {
                    <span class="keyword">if</span> (gravity.charAt(<span class="number">1</span>) == <span class="string">'w'</span>) {
                        tp.left = pos.left + pos.width / <span class="number">2</span> - <span class="number">15</span>;
                    } <span class="keyword">else</span> {
                        tp.left = pos.left + pos.width / <span class="number">2</span> - actualWidth + <span class="number">15</span>;
                    }
                }
                
                $tip.css(tp).addClass(<span class="string">'tipsy-'</span> + gravity);
                $tip.find(<span class="string">'.tipsy-arrow'</span>)[<span class="number">0</span>].className = <span class="string">'tipsy-arrow tipsy-arrow-'</span> + gravity.charAt(<span class="number">0</span>);
                <span class="keyword">if</span> (<span class="keyword">this</span>.options.className) {
                    $tip.addClass(maybeCall(<span class="keyword">this</span>.options.className, <span class="keyword">this</span>.$element[<span class="number">0</span>]));
                }
                
                <span class="keyword">if</span> (<span class="keyword">this</span>.options.fade) {
                    $tip.stop().css({opacity: <span class="number">0</span>, display: <span class="string">'block'</span>, visibility: <span class="string">'visible'</span>}).animate({opacity: <span class="keyword">this</span>.options.opacity});
                } <span class="keyword">else</span> {
                    $tip.css({visibility: <span class="string">'visible'</span>, opacity: <span class="keyword">this</span>.options.opacity});
                }

                <span class="keyword">var</span> t = <span class="keyword">this</span>;
                <span class="keyword">var</span> set_hovered  = <span class="function"><span class="keyword">function</span><span class="params">(set_hover)</span>{</span>
                    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
                        t.$tip.stop();
                        t.tipHovered = set_hover;
                        <span class="keyword">if</span> (!set_hover){
                            <span class="keyword">if</span> (t.options.delayOut === <span class="number">0</span> &amp;&amp; t.options.trigger != <span class="string">'manual'</span>) {
                                t.hide();
                            } <span class="keyword">else</span> {
                                setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> 
                                    <span class="keyword">if</span> (t.hoverState == <span class="string">'out'</span>) t.hide(); }, t.options.delayOut);
                            }
                        }
                    };
                };
               $tip.hover(set_hovered(<span class="literal">true</span>), set_hovered(<span class="literal">false</span>));
            }
        },
        
        hide: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">if</span> (<span class="keyword">this</span>.options.fade) {
                <span class="keyword">this</span>.tip().stop().fadeOut(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> $(<span class="keyword">this</span>).remove(); });
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.tip().remove();
            }
        },
        
        fixTitle: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">var</span> $e = <span class="keyword">this</span>.$element;
            
            <span class="keyword">if</span> ($e.attr(<span class="string">'title'</span>) || <span class="keyword">typeof</span>($e.attr(<span class="string">'original-title'</span>)) != <span class="string">'string'</span>) {
                $e.attr(<span class="string">'original-title'</span>, $e.attr(<span class="string">'title'</span>) || <span class="string">''</span>).removeAttr(<span class="string">'title'</span>);
            }
            <span class="keyword">if</span> (<span class="keyword">typeof</span> $e.context.nearestViewportElement == <span class="string">'object'</span>){                                                        
                <span class="keyword">if</span> ($e.children(<span class="string">'title'</span>).length){
                    $e.append(<span class="string">'&lt;original-title&gt;'</span> + ($e.children(<span class="string">'title'</span>).text() || <span class="string">''</span>) + <span class="string">'&lt;/original-title&gt;'</span>)
                        .children(<span class="string">'title'</span>).remove();
                }
            }
        },
        
        getTitle: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            
            <span class="keyword">var</span> title, $e = <span class="keyword">this</span>.$element, o = <span class="keyword">this</span>.options;
            <span class="keyword">this</span>.fixTitle();

            <span class="keyword">if</span> (<span class="keyword">typeof</span> o.title == <span class="string">'string'</span>) {
                <span class="keyword">var</span> title_name = o.title == <span class="string">'title'</span> ? <span class="string">'original-title'</span> : o.title;
                <span class="keyword">if</span> ($e.children(title_name).length){
                    title = $e.children(title_name).html();
                } <span class="keyword">else</span>{
                    title = $e.attr(title_name);
                    <span class="keyword">if</span> (<span class="keyword">typeof</span> title == <span class="string">'undefined'</span>) title = <span class="string">''</span>
                }
                
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> o.title == <span class="string">'function'</span>) {
                title = o.title.call($e[<span class="number">0</span>]);
            }
            title = (<span class="string">''</span> + title).replace(<span class="regexp">/(^\s*|\s*$)/</span>, <span class="string">""</span>);
            <span class="keyword">return</span> title || o.fallback;
        },
        
        tip: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">if</span> (!<span class="keyword">this</span>.$tip) {
                <span class="keyword">this</span>.$tip = $(<span class="string">'&lt;div class="tipsy"&gt;&lt;/div&gt;'</span>).html(<span class="string">'&lt;div class="tipsy-arrow"&gt;&lt;/div&gt;&lt;div class="tipsy-inner"&gt;&lt;/div&gt;'</span>);
            }
            <span class="keyword">return</span> <span class="keyword">this</span>.$tip;
        },
        
        validate: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
            <span class="keyword">if</span> (!<span class="keyword">this</span>.$element[<span class="number">0</span>].parentNode) {
                <span class="keyword">this</span>.hide();
                <span class="keyword">this</span>.$element = <span class="literal">null</span>;
                <span class="keyword">this</span>.options = <span class="literal">null</span>;
            }
        },
        
        enable: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">this</span>.enabled = <span class="literal">true</span>; },
        disable: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">this</span>.enabled = <span class="literal">false</span>; },
        toggleEnabled: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">this</span>.enabled = !<span class="keyword">this</span>.enabled; }
    };
    
    $.fn.tipsy = <span class="function"><span class="keyword">function</span><span class="params">(options)</span> {</span>
        
        <span class="keyword">if</span> (options === <span class="literal">true</span>) {
            <span class="keyword">return</span> <span class="keyword">this</span>.data(<span class="string">'tipsy'</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> options == <span class="string">'string'</span>) {
            $(<span class="keyword">this</span>).each(<span class="function"><span class="keyword">function</span><span class="params">(i,el)</span>{</span>
              <span class="keyword">if</span> ($(el).data(<span class="string">'tipsy'</span>)) {
                  tipsy = $(el).data(<span class="string">'tipsy'</span>)
                  tipsy[options]();
              }
            });
            <span class="keyword">return</span> <span class="keyword">this</span>;
        }
        
        options = $.extend({}, $.fn.tipsy.defaults, options);

        <span class="keyword">if</span> (options.hoverlock &amp;&amp; options.delayOut === <span class="number">0</span>) {
            options.delayOut = <span class="number">100</span>;
        }
        
        <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">(ele)</span> {</span>
            <span class="keyword">var</span> tipsy = $.data(ele, <span class="string">'tipsy'</span>);
            <span class="keyword">if</span> (!tipsy) {
                tipsy = <span class="keyword">new</span> Tipsy(ele, $.fn.tipsy.elementOptions(ele, options));
                $.data(ele, <span class="string">'tipsy'</span>, tipsy);
            }
            <span class="keyword">return</span> tipsy;
        }
        
        <span class="function"><span class="keyword">function</span> <span class="title">enter</span><span class="params">()</span> {</span>
            <span class="keyword">var</span> tipsy = get(<span class="keyword">this</span>);
            tipsy.hoverState = <span class="string">'in'</span>;
            <span class="keyword">if</span> (options.delayIn === <span class="number">0</span>) {
                tipsy.show();
            } <span class="keyword">else</span> {
                tipsy.fixTitle();
                setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">if</span> (tipsy.hoverState == <span class="string">'in'</span>) tipsy.show(); }, options.delayIn);
            }
        }
        
        <span class="function"><span class="keyword">function</span> <span class="title">leave</span><span class="params">()</span> {</span>
            <span class="keyword">var</span> tipsy = get(<span class="keyword">this</span>);
            tipsy.hoverState = <span class="string">'out'</span>;
            <span class="keyword">if</span> (options.delayOut === <span class="number">0</span>) {
                tipsy.hide();
            } <span class="keyword">else</span> {
                <span class="keyword">var</span> to = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
                    <span class="keyword">if</span> (!tipsy.tipHovered || !options.hoverlock){
                        <span class="keyword">if</span> (tipsy.hoverState == <span class="string">'out'</span>) tipsy.hide(); 
                    }
                };
                setTimeout(to, options.delayOut);
            }    
        }
        
        <span class="keyword">if</span> (!options.live) <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> get(<span class="keyword">this</span>); });
        
        <span class="keyword">if</span> (options.trigger != <span class="string">'manual'</span>) {
            <span class="keyword">var</span> binder = options.live ? <span class="string">'live'</span> : <span class="string">'bind'</span>,
                eventIn = options.trigger == <span class="string">'hover'</span> ? <span class="string">'mouseenter'</span> : <span class="string">'focus'</span>,
                eventOut = options.trigger == <span class="string">'hover'</span> ? <span class="string">'mouseleave'</span> : <span class="string">'blur'</span>;
            <span class="keyword">this</span>[binder](eventIn, enter)[binder](eventOut, leave);
        }
        
        <span class="keyword">return</span> <span class="keyword">this</span>;
        
    };
    
    $.fn.tipsy.defaults = {
        className: <span class="literal">null</span>,
        delayIn: <span class="number">0</span>,
        delayOut: <span class="number">0</span>,
        fade: <span class="literal">false</span>,
        fallback: <span class="string">''</span>,
        gcInterval: <span class="number">0</span>,
        gravity: <span class="string">'n'</span>,
        html: <span class="literal">false</span>,
        live: <span class="literal">false</span>,
        offset: <span class="number">0</span>,
        opacity: <span class="number">0.8</span>,
        title: <span class="string">'title'</span>,
        trigger: <span class="string">'hover'</span>,
        hoverlock: <span class="literal">false</span>
    };
    
    <span class="comment">// Overwrite this method to provide options on a per-element basis.</span>
    <span class="comment">// For example, you could store the gravity in a 'tipsy-gravity' attribute:</span>
    <span class="comment">// return $.extend({}, options, {gravity: $(ele).attr('tipsy-gravity') || 'n' });</span>
    <span class="comment">// (remember - do not modify 'options' in place!)</span>
    $.fn.tipsy.elementOptions = <span class="function"><span class="keyword">function</span><span class="params">(ele, options)</span> {</span>
        <span class="keyword">return</span> $.metadata ? $.extend({}, options, $(ele).metadata()) : options;
    };
    
    $.fn.tipsy.autoNS = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        <span class="keyword">return</span> $(<span class="keyword">this</span>).offset().top &gt; ($(document).scrollTop() + $(window).height() / <span class="number">2</span>) ? <span class="string">'s'</span> : <span class="string">'n'</span>;
    };
    
    $.fn.tipsy.autoWE = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        <span class="keyword">return</span> $(<span class="keyword">this</span>).offset().left &gt; ($(document).scrollLeft() + $(window).width() / <span class="number">2</span>) ? <span class="string">'e'</span> : <span class="string">'w'</span>;
    };
    
    <span class="comment">/**
     * yields a closure of the supplied parameters, producing a function that takes
     * no arguments and is suitable for use as an autogravity function like so:
     *
     * @param margin (int) - distance from the viewable region edge that an
     *        element should be before setting its tooltip's gravity to be away
     *        from that edge.
     * @param prefer (string, e.g. 'n', 'sw', 'w') - the direction to prefer
     *        if there are no viewable region edges effecting the tooltip's
     *        gravity. It will try to vary from this minimally, for example,
     *        if 'sw' is preferred and an element is near the right viewable 
     *        region edge, but not the top edge, it will set the gravity for
     *        that element's tooltip to be 'se', preserving the southern
     *        component.
     */</span>
     $.fn.tipsy.autoBounds = <span class="function"><span class="keyword">function</span><span class="params">(margin, prefer)</span> {</span>
		<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
			<span class="keyword">var</span> dir = {ns: prefer[<span class="number">0</span>], ew: (prefer.length &gt; <span class="number">1</span> ? prefer[<span class="number">1</span>] : <span class="literal">false</span>)},
                boundTop = $(document).scrollTop() + margin,
                boundLeft = $(document).scrollLeft() + margin,
                $<span class="keyword">this</span> = $(<span class="keyword">this</span>);

			<span class="keyword">if</span> ($<span class="keyword">this</span>.offset().top &lt; boundTop) dir.ns = <span class="string">'n'</span>;
			<span class="keyword">if</span> ($<span class="keyword">this</span>.offset().left &lt; boundLeft) dir.ew = <span class="string">'w'</span>;
			<span class="keyword">if</span> ($(window).width() + $(document).scrollLeft() - $<span class="keyword">this</span>.offset().left &lt; margin) dir.ew = <span class="string">'e'</span>;
			<span class="keyword">if</span> ($(window).height() + $(document).scrollTop() - $<span class="keyword">this</span>.offset().top &lt; margin) dir.ns = <span class="string">'s'</span>;

			<span class="keyword">return</span> dir.ns + (dir.ew ? dir.ew : <span class="string">''</span>);
		};
    };
})(jQuery);</code></pre></div><div class="gist-source"><h2>trust-business.csv<a name="trust-business.csv" href="http://bl.ocks.org/nsonnad/4481531#trust-business.csv">#</a></h2><pre><code class="undefined">country,trust,business,gdppc,region
Argentina,-28,168,17554.119067691,S. America
Bangladesh,-15,129,1776.89282453484,Asia
Bolivia,-44,155,5099.09217996094,S. America
Brazil,-52,130,11639.7194954807,S. America
Britain,30,7,35656.9565075244,Europe
Bulgaria,-9,66,14825.0771657591,Europe
Canada,47,17,40369.5851161718,N. America
Chile,-56,37,17310.2800735025,S. America
China,78,91,8400.16260969792,Asia
Czech Rep.,-18,65,26207.6874532862,Europe
Egypt,21,109,6280.99463624316,Middle East
Ethiopia,-5,127,1108.87789464894,Sub-Saharan Africa
France,-23,34,35245.6079040649,Europe
Germany,4,20,39491.0260257692,Europe
Ghana,-26,64,1871.14094809382,Sub-Saharan Africa
India,7,132,3627.14341118417,Asia
Indonesia,18,128,4636.19678834347,Asia
Israel,-31,38,27824.8829745345,Middle East
Italy,-26,73,32647.4649463297,Europe
CÃ´te d'Ivoire,-14,177,1789.36129264033,Sub-Saharan Africa
Japan,-16,24,34313.5804900522,Asia
Jordan,2,106,5966.03602904957,Middle East
Kenya,-87,121,1709.50812446534,Sub-Saharan Africa
Kuwait,-76,82,54282.5861421787,Middle East
Lebanon,-57,115,14608.6694472067,Middle East
Malaysia,13,12,16050.9137705718,Asia
Mali,-16,151,1091.11012833182,Sub-Saharan Africa
Mexico,-6,48,15266.2097793612,N. America
Morocco,-10,97,4952.4368731,Middle East
Nigeria,-55,131,2533.05299394733,Sub-Saharan Africa
Pakistan,25,107,2744.83233934761,Asia
Peru,-56,43,10233.9466428683,S. America
Poland,-7,55,21260.5863057129,Europe
Russia,5,112,21245.9248859672,Europe
South Africa,-31,39,10959.7417065231,Sub-Saharan Africa
South Korea,-8,8,30286.1443265803,Asia
Senegal,-55,166,1967.1329427994,Sub-Saharan Africa
Slovakia,-17,46,23910.3901606441,Europe
Spain,-23,44,32044.6181153156,Europe
Sweden,82,13,41467.4196021543,Europe
Tanzania,-33,134,1512.4885492,Sub-Saharan Africa
Turkey,-27,71,17110.1200448083,Europe
Uganda,-63,120,1344.9193805938,Sub-Saharan Africa
Ukraine,-8,137,7208.0899576188,Europe
United States,12,4,48111.9669095909,N. America
Venezuela,-2,180,12748.7408127178,S. America</code></pre></div></div>

<script src="./Scatterplot  Social trust vs ease of doing business_files/d3.v3.min.js"></script>
<script src="./Scatterplot  Social trust vs ease of doing business_files/highlight.min.js"></script>
<script>

var gist = {"history":[{"version":"dd320c8ca9a783dfa5bcf2e7907e39674272aae5"}],"files":{"README.md":{"language":"Markdown","type":"text/plain","filename":"README.md","size":384,"sha":"260fdfc1407b94d3c0ec7c17ad04c0dfeef71ecd"},"index.html":{"language":"HTML","type":"text/html","filename":"index.html","size":6189,"sha":"1179bd4866ad9704bbfb1252ef03a8a117fe3f48"},"jquery.tipsy.js":{"language":"JavaScript","type":"application/javascript","filename":"jquery.tipsy.js","size":12925,"sha":"10d2a92ddc7e5230f43d4a2eba309acbb38e6e16"},"trust-business.csv":{"language":null,"type":"text/csv","filename":"trust-business.csv","size":1985,"sha":"38992725523bc2c8668e19589b719f98d3c3f0c2"}},"created_at":"2013-01-08T05:42:16.000Z","updated_at":"2014-08-13T20:26:27.000Z","description":"Scatterplot: Social trust vs ease of doing business","owner":{"login":"nsonnad"},"id":"4481531"};

var files = d3.values(gist.files)
    .sort(function(a, b) { return (b.filename === "index.html") - (a.filename === "index.html") || a.filename.localeCompare(b.filename); });

var readme = d3.selectAll(".gist-readme")
    .data(files.filter(function(d) { return /^readme\b/i.test(d.filename) && d.language === "Markdown"; }))
    .each(function(d) {
      var readme = d3.select(this);
      d3.text("/nsonnad/raw/4481531/dd320c8ca9a783dfa5bcf2e7907e39674272aae5/" + d.filename, function(error, content) {
        readme.html(new Showdown.converter().makeHtml(content));
        readme.selectAll("code").each(function() { hljs.highlightBlock(this); });
      });
    });

var source = d3.select(".gist-sources").selectAll(".gist-source")
    .data(files.filter(function(d) { return !/^readme\b/i.test(d.filename) && d.size < 50000 && text(d.type); }))
  .enter().append("div")
    .attr("class", "gist-source");

source.append("h2")
    .text(function(d) { return d.filename; })
  .append("a")
    .attr("name", function(d) { return d.filename; })
    .attr("href", function(d) { return "#" + d.filename; })
    .text("#");

source.append("pre").append("code")
    .attr("class", function(d) { return d.language && (d.language === "JSON" ? "javascript" : d.language.toLowerCase()); })
    .each(function(d) {
      var code = d3.select(this);
      d3.text("/nsonnad/raw/4481531/dd320c8ca9a783dfa5bcf2e7907e39674272aae5/" + (d.filename === "index.html" ? "" : d.filename), function(error, content) {
        code.text(content);
        hljs.highlightBlock(code.node());
      });
    });

function text(type) {
  return /(^text\/)|(^application\/(javascript|json)$)|(^image\/svg$)|(\+xml$)/.test(type);
}

</script>

<footer>
  <a href="http://bl.ocks.org/nsonnad">nsonnad</a>â€™s block
  <a class="gist" title="View gist #4481531 on GitHub" href="https://gist.github.com/nsonnad/4481531">#4481531</a>
  <span class="date">January 8, 2013</span>
</footer>

<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-1", "ocks.org");
ga("send", "pageview");

</script>
<script async="" src="./Scatterplot  Social trust vs ease of doing business_files/analytics.js"></script>
</body><object id="3a685b8a-d8b8-989d-da1a-dba8189486b9" width="0" height="0" type="application/gas-events-bb"></object></html>